ext {
    def coreBuildFilePath = 'https://raw.githubusercontent.com/grails/grails-core/3.3.x/gradle.properties'
    def coreBuildFileUrl = new URL(coreBuildFilePath)
    def versionNumberRegex = /projectVersion=(.*)/
    def grailsVersionList = []
    coreBuildFileUrl.eachLine { line ->
        def matcher = (line =~ versionNumberRegex)
        if(matcher) {
            grailsVersionList << matcher[0][1]
        }
    }
    if(!grailsVersionList) {
        throw new GradleException("Could not find Grails version at $coreBuildFilePath")
    } else if(grailsVersionList.size() > 1) {
        throw new GradleException("Multiple Grails versions (${grailsVersionList}) found at $coreBuildFilePath")
    }
    grailsVersion = grailsVersionList[0]

    def gormVersionNumberRegex = /^\s*datastoreVersion\s*=\s*['|"](.*)['|"]\s*$/
    def gormVersionList = []
    coreBuildFileUrl.eachLine { line ->
        def matcher = (line =~ gormVersionNumberRegex)
        if(matcher) {
            gormVersionList << matcher[0][1]
        }
    }
    if(!gormVersionList) {
        throw new GradleException("Could not find Gorm version at $coreBuildFilePath")
    } else if(gormVersionList.size() > 1) {
        throw new GradleException("Multiple Gorm versions (${gormVersionList}) found at $coreBuildFilePath")
    }
    gormVersion = gormVersionList[0]
}

subprojects {
    configurations.all {
        // check for updates every build
        resolutionStrategy.cacheChangingModulesFor 0, 'seconds'
    }
}
